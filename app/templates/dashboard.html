<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sports AI â€” Predictions & Arbitrage</title>
<style>
:root{--bg:#0a0b10;--surface:rgba(22,24,35,0.8);--surface2:rgba(30,33,48,0.7);--glass:rgba(255,255,255,0.03);--border:rgba(255,255,255,0.08);--text:#eef0f6;--dim:#6b7080;--accent:#7c6cf0;--green:#2dd4a0;--red:#f05252;--yellow:#f0c040;--blue:#4ea8f0;--glow:rgba(124,108,240,0.15)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;background-image:radial-gradient(ellipse at 20% 0%,rgba(124,108,240,0.08) 0%,transparent 60%),radial-gradient(ellipse at 80% 100%,rgba(45,212,160,0.05) 0%,transparent 60%)}
::selection{background:var(--accent);color:#fff}
/* Header */
.hdr{backdrop-filter:blur(20px);background:var(--surface);border-bottom:1px solid var(--border);padding:.9rem 2rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;flex-wrap:wrap;gap:.6rem}
.hdr h1{font-size:1.2rem;font-weight:800;letter-spacing:-.02em}.hdr h1 span{background:linear-gradient(135deg,var(--accent),var(--green));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hdr-r{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
select,button{background:var(--surface2);color:var(--text);border:1px solid var(--border);padding:.42rem .85rem;border-radius:10px;font-size:.8rem;font-weight:600;cursor:pointer;transition:all .2s;backdrop-filter:blur(10px)}
button:hover{border-color:var(--accent);box-shadow:0 0 20px var(--glow)}
button.primary{background:linear-gradient(135deg,var(--accent),#9b8cf0);border:none;color:#fff}
button.primary:hover{transform:translateY(-1px);box-shadow:0 4px 20px var(--glow)}
.badge{font-size:.68rem;padding:.18rem .55rem;border-radius:8px;font-weight:700;letter-spacing:.03em}
.bg{background:rgba(45,212,160,0.15);color:var(--green)}.by{background:rgba(240,192,64,0.15);color:var(--yellow)}.br{background:rgba(240,82,82,0.15);color:var(--red)}.bb{background:rgba(78,168,240,0.15);color:var(--blue)}.bp{background:rgba(124,108,240,0.15);color:var(--accent)}
.container{max-width:1360px;margin:0 auto;padding:1.3rem 2rem}
/* Tabs */
.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:1.5rem}
.tab{padding:.7rem 1.3rem;font-size:.82rem;font-weight:700;color:var(--dim);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:.2s;letter-spacing:.01em}
.tab:hover{color:var(--text)}.tab.active{color:var(--accent);border-color:var(--accent)}
.panel{display:none;animation:fadeIn .3s}.panel.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
/* Cards grid */
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.8rem;margin-bottom:1.3rem}
.card{backdrop-filter:blur(12px);background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:.9rem 1.1rem;transition:all .2s}
.card:hover{border-color:rgba(124,108,240,0.3);box-shadow:0 4px 20px var(--glow)}
.card .lb{font-size:.68rem;color:var(--dim);text-transform:uppercase;letter-spacing:.06em;font-weight:600}
.card .vl{font-size:1.45rem;font-weight:800;margin-top:.15rem}
/* Tables */
table{width:100%;border-collapse:collapse;border-radius:14px;overflow:hidden}
thead{background:var(--surface2)}
th{padding:.6rem .9rem;text-align:left;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;color:var(--dim);font-weight:700}
td{padding:.55rem .9rem;font-size:.82rem;border-top:1px solid var(--border)}
tr{transition:background .15s}tr:hover{background:var(--glass)}
.r{text-align:right}.c{text-align:center}
/* Prediction card â€” clickable with expand */
.pred{backdrop-filter:blur(12px);background:var(--surface);border:1px solid var(--border);border-radius:14px;margin-bottom:.7rem;overflow:hidden;transition:all .25s;cursor:pointer}
.pred:hover{border-color:rgba(124,108,240,0.3);box-shadow:0 4px 24px var(--glow);transform:translateY(-1px)}
.pred-main{padding:1rem 1.2rem}
.pred-top{display:flex;justify-content:space-between;align-items:flex-start}
.pred-matchup{font-size:.95rem;font-weight:700;letter-spacing:-.01em}
.pred-meta{display:flex;gap:.4rem;margin-top:.25rem;font-size:.72rem;color:var(--dim);flex-wrap:wrap;align-items:center}
.pred-pick{text-align:right}
.pred-winner{font-size:1.05rem;font-weight:800}
.pred-conf{font-size:.75rem;color:var(--dim);margin-top:.1rem}
.bar-wrap{height:5px;background:var(--surface2);border-radius:3px;margin-top:.5rem;overflow:hidden}
.bar-fill{height:100%;border-radius:3px;transition:width .6s ease}
/* Expand details */
.pred-details{display:none;border-top:1px solid var(--border);padding:1rem 1.2rem;background:var(--glass);animation:fadeIn .25s}
.pred.expanded .pred-details{display:block}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.detail-section h4{font-size:.72rem;text-transform:uppercase;letter-spacing:.05em;color:var(--dim);margin-bottom:.4rem;font-weight:700}
.feature-row{display:flex;justify-content:space-between;align-items:center;padding:.2rem 0;font-size:.78rem;border-bottom:1px solid rgba(255,255,255,0.03)}
.feature-bar{height:4px;border-radius:2px;margin-top:.15rem;min-width:2px;max-width:120px;transition:width .4s}
.inj-pill{display:inline-flex;align-items:center;gap:.3rem;padding:.15rem .5rem;border-radius:6px;font-size:.7rem;font-weight:600;margin:.1rem .15rem 0 0}
.inj-out{background:rgba(240,82,82,0.15);color:var(--red)}.inj-q{background:rgba(240,192,64,0.12);color:var(--yellow)}
/* Spread section */
.spread-box{margin-top:.6rem;padding:.6rem .85rem;background:var(--glass);border-radius:10px;border-left:3px solid var(--dim)}
/* Value bets */
.vb{backdrop-filter:blur(12px);background:var(--surface);border:1px solid rgba(45,212,160,0.2);border-radius:14px;padding:1rem 1.2rem;margin-bottom:.7rem;transition:all .2s}
.vb:hover{border-color:var(--green);box-shadow:0 4px 20px rgba(45,212,160,0.1)}
/* Arb */
.arb-card{backdrop-filter:blur(12px);background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:1rem 1.2rem;margin-bottom:.7rem}
/* Tracker */
.bet-row{display:flex;justify-content:space-between;align-items:center;padding:.55rem .9rem;border-top:1px solid var(--border);font-size:.8rem;transition:background .15s}
.bet-row:hover{background:var(--glass)}
.bet-actions button{font-size:.68rem;padding:.2rem .45rem;margin-left:.25rem;border-radius:6px;border:none;cursor:pointer;font-weight:700}
.bw{background:var(--green);color:#000}.bl{background:var(--red);color:#fff}.bpush{background:var(--yellow);color:#000}
/* Modal */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(8px);z-index:900;align-items:center;justify-content:center}
.modal-bg.open{display:flex}
.modal{background:rgba(22,24,35,0.95);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:1.5rem;width:min(440px,92vw);max-height:82vh;overflow-y:auto}
.modal h2{font-size:1.05rem;margin-bottom:.9rem;font-weight:800}
.modal label{display:block;font-size:.72rem;color:var(--dim);margin-top:.6rem;margin-bottom:.15rem;font-weight:600;text-transform:uppercase;letter-spacing:.04em}
.modal input,.modal select,.modal textarea{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:.4rem .6rem;font-size:.82rem}
.modal textarea{resize:vertical;min-height:45px}
.modal-actions{display:flex;gap:.5rem;margin-top:1rem;justify-content:flex-end}
/* Empty */
.empty{text-align:center;padding:3rem 1rem;color:var(--dim)}.empty h2{font-size:1.1rem;margin-bottom:.3rem;color:var(--text);font-weight:700}
/* Misc */
.spin{display:inline-block;width:13px;height:13px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle;margin-right:.3rem}
@keyframes sp{to{transform:rotate(360deg)}}
.toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--surface);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:12px;padding:.65rem 1rem;font-size:.8rem;opacity:0;transform:translateY(.8rem);transition:.3s;z-index:1000;box-shadow:0 8px 30px rgba(0,0,0,.5)}
.toast.show{opacity:1;transform:translateY(0)}
.click-hint{font-size:.65rem;color:var(--dim);margin-top:.3rem;font-style:italic}
@media(max-width:640px){.hdr{padding:.7rem 1rem;flex-direction:column}.container{padding:.8rem 1rem}.cards{grid-template-columns:1fr 1fr}.detail-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="hdr">
  <h1>âš¡ Sports <span>AI</span></h1>
  <div class="hdr-r">
    <select id="sportSel" onchange="switchSport()">
      <option value="NBA">ğŸ€ NBA</option><option value="NFL">ğŸˆ NFL</option>
      <option value="NCAAM">ğŸ€ NCAAM</option><option value="NCAAF">ğŸˆ NCAAF</option>
      <option value="MLB">âš¾ MLB</option><option value="NHL">ğŸ’ NHL</option>
      <option value="EPL">âš½ EPL</option><option value="LA LIGA">âš½ La Liga</option>
      <option value="SERIE A">âš½ Serie A</option><option value="UCL">âš½ UCL</option>
    </select>
    <button onclick="doRefresh()" id="refreshBtn">â†» Refresh</button>
    <span id="badge" class="badge bg">Ready</span>
  </div>
</div>
<div class="container">
  <div class="tabs">
    <div class="tab active" onclick="showTab('predictions',this)">ğŸ¤– Predictions</div>
    <div class="tab" onclick="showTab('standings',this)">ğŸ“Š Standings</div>
    <div class="tab" onclick="showTab('valuebets',this)">ğŸ’° Value Bets</div>
    <div class="tab" onclick="showTab('arbitrage',this)">âš–ï¸ Arbitrage</div>
    <div class="tab" onclick="showTab('tracker',this);loadTracker()">ğŸ“ˆ Tracker</div>
  </div>
  <div id="predictions" class="panel active"><div class="cards" id="predStats"></div><div id="predList"></div></div>
  <div id="standings" class="panel"><div id="standingsTable"></div></div>
  <div id="valuebets" class="panel"><div class="cards" id="vbStats"></div><div id="vbList"></div></div>
  <div id="arbitrage" class="panel"><div class="cards" id="arbStats"></div><div id="arbList"></div></div>
  <div id="tracker" class="panel"><div class="cards" id="trackerStats"></div><div style="margin-bottom:1rem;display:flex;gap:.5rem"><button class="primary" onclick="openBetModal()">+ Log Bet</button><button onclick="checkScores()">ğŸ”„ Check Scores</button></div><div id="trackerList" style="background:var(--surface);border-radius:14px;overflow:hidden"></div></div>
</div>
<!-- Bet Modal -->
<div class="modal-bg" id="betModal">
  <div class="modal">
    <h2>ğŸ“ Log a Bet</h2>
    <label>Sport</label><select id="bSport"><option>NBA</option><option>NFL</option><option>NCAAM</option><option>NCAAF</option><option>MLB</option><option>NHL</option><option>EPL</option><option>La Liga</option><option>Serie A</option><option>UCL</option></select>
    <label>Matchup</label><input id="bEvent" placeholder="Team A vs Team B">
    <label>Type</label><select id="bType"><option value="moneyline">Moneyline</option><option value="spread">Spread</option><option value="total">Over/Under</option><option value="other">Other</option></select>
    <label>Pick</label><input id="bPick" placeholder="e.g. Pistons or Over 220.5">
    <label>Odds (American)</label><input id="bOdds" type="number" placeholder="-110">
    <label>Stake ($)</label><input id="bStake" type="number" placeholder="100" step="1">
    <label>Confidence (0-100)</label><input id="bConf" type="number" placeholder="72" min="0" max="100">
    <label>Notes</label><textarea id="bNotes" placeholder="Why you like this bet..."></textarea>
    <div class="modal-actions">
      <button onclick="closeBetModal()">Cancel</button>
      <button class="primary" onclick="submitBet()">Save Bet</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>
<script>
let currentSport='NBA';
const T={'lock':'ğŸ”’','strong':'ğŸ’ª','lean':'ğŸ¤”','toss-up':'ğŸ²'};
const TC={'lock':'var(--green)','strong':'var(--blue)','lean':'var(--yellow)','toss-up':'var(--dim)'};
function showTab(id,el){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));el.classList.add('active');document.getElementById(id).classList.add('active')}
function pct(v){return(v*100).toFixed(0)+'%'}
function fmt(iso){if(!iso)return'';try{return new Date(iso).toLocaleString(undefined,{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'})}catch(e){return''}}
function toast(m,ms=3000){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),ms)}
function switchSport(){currentSport=document.getElementById('sportSel').value;loadAll()}
async function doRefresh(){const b=document.getElementById('refreshBtn');b.disabled=true;b.textContent='...';try{await fetch('/api/refresh',{method:'POST'});toast('Refreshed')}catch(e){toast('Error')}finally{b.disabled=false;b.textContent='â†» Refresh'}loadAll()}

// â”€â”€ PREDICTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._predBets=[];
async function loadPredictions(){
  const el=document.getElementById('predList'),st=document.getElementById('predStats');
  el.innerHTML='<div class="empty"><span class="spin"></span> Analyzing games...</div>';
  try{
    const r=await fetch('/api/predictions?sport='+currentSport);const d=await r.json();
    const preds=d.predictions||[],vb=d.value_bets||[];
    st.innerHTML=`<div class="card"><div class="lb">Predictions</div><div class="vl">${preds.length}</div></div>
      <div class="card"><div class="lb">Value Bets</div><div class="vl" style="color:var(--green)">${vb.length}</div></div>
      <div class="card"><div class="lb">Teams</div><div class="vl">${d.teams_with_stats||0}</div></div>
      <div class="card"><div class="lb">Injuries</div><div class="vl">${d.injuries_loaded||0} teams</div></div>
      <div class="card"><div class="lb">High Conf</div><div class="vl" style="color:var(--blue)">${preds.filter(p=>p.confidence>=0.65).length}</div></div>`;
    if(!preds.length){el.innerHTML='<div class="empty"><h2>No predictions</h2><p>No games found. Try a different sport or check back later.</p></div>';renderValueBets(vb);return}
    window._predBets=[];
    el.innerHTML=preds.map((p,i)=>{
      const wp=Math.max(p.home_win_prob,p.away_win_prob);
      const clr=TC[p.confidence_label]||'var(--dim)';
      const emoji=T[p.confidence_label]||'';
      // Store bet prefills
      var mlIdx=window._predBets.length;
      window._predBets.push({sport:currentSport,event:p.away_team+' vs '+p.home_team,home_team:p.home_team,away_team:p.away_team,type:'moneyline',pick:p.predicted_winner,confidence:p.confidence,notes:'AI: '+pct(wp)+' win, '+p.confidence_label});
      var spIdx=-1;
      if(p.book_spread!=null&&p.cover_side){spIdx=window._predBets.length;window._predBets.push({sport:currentSport,event:p.away_team+' vs '+p.home_team,home_team:p.home_team,away_team:p.away_team,type:'spread',pick:(p.cover_side==='home'?p.home_team:p.away_team)+' '+(p.book_spread>0?'+':'')+p.book_spread,spread_line:p.book_spread,confidence:p.cover_confidence,notes:'Spread: '+(p.cover_label||'')})}
      // Injury pills
      var injHtml='';
      if(p.home_injuries&&p.home_injuries.total_out>0)injHtml+=`<span class="inj-pill inj-out">ğŸ¥ ${p.home_team.split(' ').pop()}: ${p.home_injuries.total_out} out</span>`;
      if(p.away_injuries&&p.away_injuries.total_out>0)injHtml+=`<span class="inj-pill inj-out">ğŸ¥ ${p.away_team.split(' ').pop()}: ${p.away_injuries.total_out} out</span>`;
      if(p.home_injuries&&p.home_injuries.total_questionable>0)injHtml+=`<span class="inj-pill inj-q">${p.home_team.split(' ').pop()}: ${p.home_injuries.total_questionable}Q</span>`;
      if(p.away_injuries&&p.away_injuries.total_questionable>0)injHtml+=`<span class="inj-pill inj-q">${p.away_team.split(' ').pop()}: ${p.away_injuries.total_questionable}Q</span>`;
      // Feature breakdown
      var feats=(p.feature_explanations||[]);
      var featHtml=feats.map(f=>{
        var barW=Math.min(Math.abs(f.impact)*300,100);
        var barClr=f.direction==='home'?'var(--green)':'var(--red)';
        return`<div class="feature-row"><span>${f.description}</span><span style="font-weight:700;color:${barClr}">${f.impact>0?'+':''}${f.impact.toFixed(3)}</span></div><div class="feature-bar" style="width:${barW}px;background:${barClr}"></div>`;
      }).join('');
      // Injury detail in expand
      var injDetailHtml='';
      [['ğŸ  '+p.home_team,p.home_injuries],['âœˆï¸ '+p.away_team,p.away_injuries]].forEach(([label,inj])=>{
        if(inj){
          injDetailHtml+=`<div style="margin-bottom:.5rem"><strong style="font-size:.78rem">${label}</strong>
            <span class="badge ${inj.impact_score>=0.3?'br':inj.impact_score>0?'by':'bg'}" style="margin-left:.3rem">Impact: ${(inj.impact_score*100).toFixed(0)}%</span>`;
          if(inj.out&&inj.out.length)injDetailHtml+=`<div style="font-size:.72rem;color:var(--red);margin-top:.2rem">OUT: ${inj.out.map(x=>x.name+' ('+x.position+')').join(', ')}</div>`;
          if(inj.questionable&&inj.questionable.length)injDetailHtml+=`<div style="font-size:.72rem;color:var(--yellow);margin-top:.1rem">GTD: ${inj.questionable.map(x=>x.name).join(', ')}</div>`;
          injDetailHtml+=`<div style="font-size:.7rem;color:var(--dim);margin-top:.1rem">${inj.summary||''}</div></div>`;
        }
      });
      // Spread section
      var spreadHtml='';
      if(p.book_spread!=null&&p.cover_prob!=null){
        var cClr=TC[p.cover_label]||'var(--dim)';
        var coverTeam=p.cover_side==='home'?p.home_team:p.away_team;
        var dp=(Math.max(p.cover_prob,1-p.cover_prob)*100).toFixed(0);
        spreadHtml=`<div class="spread-box" style="border-color:${cClr}"><div style="display:flex;justify-content:space-between"><div><span style="font-size:.68rem;color:var(--dim);text-transform:uppercase">Spread</span><div style="font-weight:700;font-size:.88rem">${coverTeam} covers ${p.book_spread>0?'+':''}${p.book_spread}</div></div><div style="text-align:right"><div style="font-size:1rem;font-weight:800;color:${cClr}">${dp}%</div><div style="font-size:.68rem;color:var(--dim)">${(p.cover_label||'').toUpperCase()}</div></div></div></div>`}
      return`<div class="pred" onclick="this.classList.toggle('expanded')" data-testid="pred-card">
        <div class="pred-main">
          <div class="pred-top">
            <div><div class="pred-matchup">${p.away_team} @ ${p.home_team}</div>
              <div class="pred-meta"><span class="badge bb">${currentSport}</span>${fmt(p.commence_time)?`<span>${fmt(p.commence_time)}</span>`:''}${p.spread_prediction?`<span>Line: ${p.spread_prediction>0?'+':''}${p.spread_prediction}</span>`:''}</div>
              ${injHtml?`<div style="margin-top:.3rem">${injHtml}</div>`:''}
            </div>
            <div class="pred-pick"><div class="pred-winner" style="color:${clr}">${emoji} ${p.predicted_winner}</div><div class="pred-conf">${pct(wp)} Â· ${pct(p.confidence)} conf</div></div>
          </div>
          <div class="bar-wrap"><div class="bar-fill" style="width:${wp*100}%;background:${clr}"></div></div>
          ${spreadHtml}
          <div class="click-hint">Click to see full breakdown â†’</div>
        </div>
        <div class="pred-details">
          <div class="detail-grid">
            <div><div class="detail-section"><h4>ğŸ“Š Feature Breakdown</h4>${featHtml||'<div style="font-size:.78rem;color:var(--dim)">No detailed features available</div>'}</div></div>
            <div><div class="detail-section"><h4>ğŸ¥ Injury Report</h4>${injDetailHtml||'<div style="font-size:.78rem;color:var(--dim)">No injury data available for this matchup</div>'}</div></div>
          </div>
          <div style="margin-top:.7rem;font-size:.78rem;color:var(--dim)">${p.reasoning}</div>
          <div style="margin-top:.6rem;display:flex;gap:.4rem;flex-wrap:wrap">
            <button class="primary" style="font-size:.72rem;padding:.25rem .7rem" onclick="event.stopPropagation();openBetModal(window._predBets[${mlIdx}])">ğŸ“ Track Moneyline</button>
            ${spIdx>=0?`<button style="font-size:.72rem;padding:.25rem .7rem" onclick="event.stopPropagation();openBetModal(window._predBets[${spIdx}])">ğŸ“ Track Spread</button>`:''}
          </div>
        </div>
      </div>`}).join('');
    renderValueBets(vb);
  }catch(e){el.innerHTML='<div class="empty"><h2>Error</h2><p>'+e.message+'</p></div>'}
}
// â”€â”€ STANDINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadStandings(){
  const el=document.getElementById('standingsTable');
  el.innerHTML='<div class="empty"><span class="spin"></span> Loading...</div>';
  try{const r=await fetch('/api/standings?sport='+currentSport);const d=await r.json();const teams=d.standings||[];
    if(!teams.length){el.innerHTML='<div class="empty"><h2>No data</h2><p>ESPN may not have standings for this sport right now.</p></div>';return}
    el.innerHTML=`<table><thead><tr><th>#</th><th>Team</th><th class="r">Record</th><th class="r">Win%</th><th class="r">PPG</th><th class="r">Opp PPG</th><th class="r">Diff</th><th class="c">Streak</th></tr></thead><tbody>`+
      teams.map((t,i)=>`<tr><td>${i+1}</td><td><strong>${t.team}</strong></td><td class="r">${t.record}</td><td class="r">${t.win_pct.toFixed(3)}</td><td class="r">${t.ppg.toFixed(1)}</td><td class="r">${t.opp_ppg.toFixed(1)}</td><td class="r" style="color:${t.point_diff>0?'var(--green)':t.point_diff<0?'var(--red)':'var(--dim)'};font-weight:700">${t.point_diff>0?'+':''}${t.point_diff.toFixed(1)}</td><td class="c" style="color:${t.streak>0?'var(--green)':t.streak<0?'var(--red)':'var(--dim)'};font-weight:700">${t.streak>0?'W'+t.streak:t.streak<0?'L'+Math.abs(t.streak):'â€”'}</td></tr>`).join('')+'</tbody></table>';
  }catch(e){el.innerHTML='<div class="empty">Error: '+e.message+'</div>'}
}
// â”€â”€ VALUE BETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._vbBets=[];
function renderValueBets(vbs){
  const el=document.getElementById('vbList'),st=document.getElementById('vbStats');
  if(!vbs||!vbs.length){st.innerHTML='';el.innerHTML='<div class="empty"><h2>No value bets</h2><p>Value bets appear when our model sees better odds than the books.</p></div>';return}
  st.innerHTML=`<div class="card"><div class="lb">Value Bets</div><div class="vl" style="color:var(--green)">${vbs.length}</div></div><div class="card"><div class="lb">Best Edge</div><div class="vl" style="color:var(--green)">${(vbs[0].edge_pct*100).toFixed(1)}%</div></div>`;
  window._vbBets=[];
  el.innerHTML=vbs.map(v=>{var idx=window._vbBets.length;window._vbBets.push({sport:currentSport,event:v.event_name,type:'moneyline',pick:v.team,odds:v.best_price,confidence:v.confidence,notes:'Edge: '+(v.edge_pct*100).toFixed(1)+'%'});
    return`<div class="vb"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:700;font-size:.95rem">${v.team}</div><div style="font-size:.78rem;color:var(--dim)">${v.event_name}</div></div><div style="font-size:1.15rem;font-weight:800;color:var(--green)">+${(v.edge_pct*100).toFixed(1)}%</div></div>
      <div style="display:flex;gap:1.2rem;margin-top:.4rem;font-size:.78rem;color:var(--dim)"><span>Us: <b style="color:var(--text)">${pct(v.our_prob)}</b></span><span>Book: <b style="color:var(--text)">${pct(v.book_implied_prob)}</b></span><span>Kelly: <b style="color:var(--text)">${(v.kelly_fraction*100).toFixed(1)}%</b></span><span class="badge ${v.confidence_label==='lock'?'bg':v.confidence_label==='strong'?'bb':'by'}">${v.confidence_label.toUpperCase()}</span></div>
      <div style="margin-top:.4rem"><button class="primary" style="font-size:.7rem;padding:.2rem .6rem" onclick="openBetModal(window._vbBets[${idx}])">ğŸ“ Track</button></div></div>`}).join('')}
// â”€â”€ ARBITRAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadArbitrage(){
  const el=document.getElementById('arbList'),st=document.getElementById('arbStats');
  el.innerHTML='<div class="empty"><span class="spin"></span> Loading...</div>';
  try{const r=await fetch('/api/arbitrage');const d=await r.json();const arbs=d.arbitrage||[];
    st.innerHTML=`<div class="card"><div class="lb">Live Arbs</div><div class="vl">${arbs.length}</div></div><div class="card"><div class="lb">Best</div><div class="vl" style="color:var(--green)">${arbs.length?arbs[0].profit_pct.toFixed(2)+'%':'â€”'}</div></div>`;
    if(!arbs.length){el.innerHTML='<div class="empty"><h2>No arbitrage</h2><p>Market is efficient right now.</p></div>';return}
    el.innerHTML=arbs.map(a=>{var legs=(a.legs||[]).map(l=>`<div style="background:var(--glass);border-radius:8px;padding:.6rem .8rem;flex:1;min-width:180px"><div style="font-weight:700">${l.outcome}</div><div style="font-size:.72rem;color:var(--dim)">@ ${l.bookmaker}</div><div style="display:flex;justify-content:space-between;margin-top:.3rem;font-size:.78rem"><span style="color:var(--yellow);font-weight:700">${l.price>0?'+':''}${l.price}</span><span>${l.stake_pct.toFixed(1)}%</span></div></div>`).join('');
      return`<div class="arb-card"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:700">${a.event_name}</div><div class="badge bg" style="margin-top:.2rem">${a.market.toUpperCase()}</div></div><div style="font-size:1.2rem;font-weight:800;color:var(--green)">+${a.profit_pct.toFixed(2)}%</div></div><div style="display:flex;gap:.5rem;margin-top:.6rem;flex-wrap:wrap">${legs}</div></div>`}).join('')
  }catch(e){el.innerHTML='<div class="empty">Error: '+e.message+'</div>'}
}
// â”€â”€ TRACKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._betPrefill={};
function openBetModal(pf){window._betPrefill=pf||{};if(pf){document.getElementById('bSport').value=pf.sport||currentSport;document.getElementById('bEvent').value=pf.event||'';document.getElementById('bType').value=pf.type||'moneyline';document.getElementById('bPick').value=pf.pick||'';document.getElementById('bOdds').value=pf.odds||'';document.getElementById('bStake').value=pf.stake||'';document.getElementById('bConf').value=pf.confidence?Math.round(pf.confidence*100):'';document.getElementById('bNotes').value=pf.notes||''}document.getElementById('betModal').classList.add('open')}
function closeBetModal(){document.getElementById('betModal').classList.remove('open')}
async function submitBet(){var pf=window._betPrefill||{};const body={sport:document.getElementById('bSport').value,event_name:document.getElementById('bEvent').value,home_team:pf.home_team||'',away_team:pf.away_team||'',bet_type:document.getElementById('bType').value,pick:document.getElementById('bPick').value,spread_line:pf.spread_line||null,total_line:pf.total_line||null,odds:document.getElementById('bOdds').value,stake:document.getElementById('bStake').value,confidence:document.getElementById('bConf').value?parseFloat(document.getElementById('bConf').value)/100:null,notes:document.getElementById('bNotes').value};
  if(!body.event_name||!body.pick||!body.odds||!body.stake){toast('Fill in required fields');return}
  try{const r=await fetch('/api/bets',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});const d=await r.json();toast('Bet saved â€” win $'+d.potential_win);closeBetModal();['bEvent','bPick','bOdds','bStake','bConf','bNotes'].forEach(id=>document.getElementById(id).value='');loadTracker()}catch(e){toast('Error: '+e.message)}}
async function settleBet(id,result){try{await fetch('/api/bets/'+id+'/settle',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({result})});toast('Settled as '+result.toUpperCase());loadTracker()}catch(e){toast('Error')}}
async function checkScores(){toast('Checking scores...');try{const r=await fetch('/api/bets/auto-settle',{method:'POST'});const d=await r.json();toast(d.settled>0?'Settled '+d.settled+' bets!':d.message||'No games to settle yet');loadTracker()}catch(e){toast('Error')}}
async function loadTracker(){
  const el=document.getElementById('trackerList'),st=document.getElementById('trackerStats');if(!el)return;
  el.innerHTML='<div class="empty"><span class="spin"></span></div>';
  try{const r=await fetch('/api/bets');const d=await r.json();const s=d.summary;
    const pc=s.total_pnl>=0?'var(--green)':'var(--red)';
    st.innerHTML=`<div class="card"><div class="lb">Bets</div><div class="vl">${s.total_bets}</div></div><div class="card"><div class="lb">Record</div><div class="vl">${s.wins}W-${s.losses}L</div></div><div class="card"><div class="lb">Win%</div><div class="vl" style="color:${s.win_rate>=55?'var(--green)':s.win_rate<45?'var(--red)':'var(--text)'}">${s.win_rate}%</div></div><div class="card"><div class="lb">P&L</div><div class="vl" style="color:${pc}">${s.total_pnl>=0?'+':''}$${s.total_pnl.toFixed(2)}</div></div><div class="card"><div class="lb">ROI</div><div class="vl" style="color:${pc}">${s.roi>=0?'+':''}${s.roi}%</div></div>`;
    const bets=d.bets||[];
    if(!bets.length){el.innerHTML='<div class="empty"><h2>No bets yet</h2><p>Click <b>+ Log Bet</b> or use the Track buttons on predictions.</p></div>';return}
    var html='<div class="bet-row" style="font-weight:700;font-size:.68rem;color:var(--dim);text-transform:uppercase"><span style="flex:2">Event</span><span style="flex:1">Pick</span><span style="flex:.6;text-align:right">Odds</span><span style="flex:.6;text-align:right">Stake</span><span style="flex:.6;text-align:right">Win</span><span style="flex:.6;text-align:center">Result</span><span style="flex:1;text-align:right">Actions</span></div>';
    bets.forEach(function(b){var rc=b.result==='win'?'var(--green)':b.result==='loss'?'var(--red)':b.result==='push'?'var(--yellow)':'var(--dim)';var pnl=b.result!=='pending'?'<span style="color:'+(b.actual_pnl>=0?'var(--green)':'var(--red)')+'">'+(b.actual_pnl>=0?'+':'')+'$'+b.actual_pnl.toFixed(2)+'</span>':'';var score=(b.home_score!=null&&b.away_score!=null)?'<br><span style="font-size:.68rem;color:var(--dim)">'+b.home_score+'-'+b.away_score+'</span>':'';var acts=b.result==='pending'?'<span class="bet-actions"><button class="bw" onclick="settleBet('+b.id+',\'win\')">W</button><button class="bl" onclick="settleBet('+b.id+',\'loss\')">L</button><button class="bpush" onclick="settleBet('+b.id+',\'push\')">=</button></span>':pnl;
      html+='<div class="bet-row"><span style="flex:2"><strong>'+b.event_name+'</strong>'+score+'<br><span style="font-size:.68rem;color:var(--dim)">'+b.sport+'</span></span><span style="flex:1">'+b.pick+'</span><span style="flex:.6;text-align:right">'+(b.odds>0?'+':'')+b.odds+'</span><span style="flex:.6;text-align:right">$'+b.stake.toFixed(0)+'</span><span style="flex:.6;text-align:right">$'+b.potential_win.toFixed(0)+'</span><span style="flex:.6;text-align:center"><span style="color:'+rc+';font-weight:700;text-transform:uppercase">'+b.result+'</span></span><span style="flex:1;text-align:right">'+acts+'</span></div>'});
    el.innerHTML=html}catch(e){el.innerHTML='<div class="empty">Error</div>'}
}
function loadAll(){loadPredictions();loadStandings();loadArbitrage()}
loadAll();setInterval(loadAll,120000);
</script>
</body>
</html>
